# Model Card for Guardian Agent
# EU AI Act Compliance Documentation
# Based on ML Model Cards (Mitchell et al., 2019)

model_details:
  name: Guardian Agent
  id: guardian_agent
  version: "1.0.0"
  type: Security Agent (Rule-based + LLM-enhanced)
  foundation_model: Claude (Anthropic) for advanced threat detection
  framework: MAESTRO 7-Layer Security Model
  provider: OKO Investments
  date: December 2024
  contact: security@datamigrate.ai

intended_use:
  primary_intended_uses:
    - Monitor and validate all AI agent inputs/outputs
    - Detect and block prompt injection attacks
    - Enforce data isolation between organizations
    - Rate limit agent operations
    - Provide comprehensive security audit trail

  primary_intended_users:
    - Security administrators
    - Compliance officers
    - System operators
    - Audit teams

  out_of_scope_uses:
    - Replacement for network-level security
    - End-user authentication (handled by auth service)
    - Data encryption (handled by infrastructure layer)

security_framework:
  name: MAESTRO
  source: "Cloud Security Alliance"
  reference: "Building Applications with AI Agents (O'Reilly, 2025)"
  layers:
    layer_1:
      name: Foundation Models
      scope: "Claude/Anthropic API security"
      controls:
        - API key management
        - Model access controls
        - Key rotation policies

    layer_2:
      name: Data Operations
      scope: "Database connection security"
      controls:
        - Credential encryption (AES-256)
        - Connection string sanitization
        - SQL injection prevention

    layer_3:
      name: Agent Framework
      scope: "LangGraph safeguards"
      controls:
        - State isolation between sessions
        - Tool permission boundaries
        - Execution sandboxing

    layer_4:
      name: Agent Core
      scope: "Input/output validation"
      controls:
        - Prompt injection detection
        - PII filtering
        - Behavior constraints

    layer_5:
      name: Agent Ecosystem
      scope: "Multi-agent communication"
      controls:
        - Message authentication
        - Trust boundaries
        - Inter-agent rate limiting

    layer_6:
      name: Deployment
      scope: "Infrastructure hardening"
      controls:
        - Container security
        - Environment variable protection
        - Network isolation

    layer_7:
      name: Monitoring
      scope: "Observability and audit"
      controls:
        - Security event logging
        - Prometheus metrics
        - Compliance audit trail

factors:
  relevant_factors:
    - Request volume and patterns
    - User/organization context
    - Input content characteristics
    - Historical security events

  evaluation_factors:
    - Threat detection accuracy
    - False positive rate
    - Response latency impact
    - Audit coverage completeness

metrics:
  model_performance_measures:
    - name: Prompt Injection Detection Rate
      target: 99%
      current: 98.7%
      description: Percentage of injection attempts blocked

    - name: False Positive Rate
      target: "<1%"
      current: "0.8%"
      description: Legitimate requests incorrectly blocked

    - name: Rate Limit Effectiveness
      target: 100%
      current: 100%
      description: Rate limiting functioning correctly

    - name: Audit Log Coverage
      target: 100%
      current: 100%
      description: All agent actions logged

    - name: Response Latency Impact
      target: "<50ms"
      current: "35ms"
      description: Additional latency from security checks

threat_detection:
  detection_categories:
    - category: Prompt Injection
      patterns: 20+
      severity: CRITICAL
      action: Block and log

    - category: Data Exfiltration
      patterns: 10+
      severity: HIGH
      action: Block and alert

    - category: SQL Injection
      patterns: 15+
      severity: CRITICAL
      action: Block and log

    - category: Policy Violation
      triggers: Custom per org
      severity: MEDIUM
      action: Log and notify

    - category: Rate Limit Exceeded
      default: "30 req/min"
      severity: MEDIUM
      action: Temporary block

ethical_considerations:
  data_handling:
    - Privacy-preserving input hashing (SHA256)
    - No storage of actual input content
    - Organization-level data isolation

  potential_harms:
    - Over-blocking could impede legitimate use
    - False positives could frustrate users
    - Security events could reveal system details

  mitigations:
    - Configurable sensitivity thresholds
    - Clear feedback on blocked requests
    - Minimal information in error responses
    - Rate limit bypass for verified admins

caveats_and_recommendations:
  known_limitations:
    - Novel attack patterns may evade detection
    - High-volume attacks may cause latency
    - Complex multi-step attacks require correlation

  recommendations:
    - Regular pattern updates
    - Monitor false positive rates
    - Review blocked requests periodically
    - Combine with network-level security

risk_classification:
  eu_ai_act_category: Limited Risk
  article_9_compliance:
    - Risk management system implemented
    - Continuous monitoring active
    - Incident response documented
  article_12_compliance:
    - Comprehensive audit logging
    - Privacy-preserving recordkeeping
    - 10-year retention for security events

monitoring:
  real_time_monitoring:
    - Prometheus metrics endpoint
    - Security event streaming
    - Rate limit status

  dashboards:
    - Security posture overview
    - Threat detection trends
    - Audit log analysis
    - Compliance status

  alerting:
    - Critical threat detection
    - Unusual activity patterns
    - Rate limit breaches
    - System health issues

compliance_logging:
  class: ComplianceLogger
  features:
    - EU AI Act Article 12 compliant
    - Privacy-preserving (content hashing)
    - Structured audit format
    - Regulatory query support
  retention:
    security_events: "10 years"
    agent_logs: "7 years"
    access_logs: "2 years"
